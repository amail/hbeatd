=======================
Comfirm hbeatd - README
=======================
(C) 2012 Comfirm AB

Simple, lightweight and zero-configuration heartbeat sensor and pulse generator.

Authors:
Jack Engqvist Johansson, Comfirm AB
http://comfirm.se

License:
BSD 3-Clause
See the LICENSE file

Usage
=====
usage: hbeatd [-v [-s | -p [-d]] -P -r]
 -p	run as heartbeat pulse (default)
 -s	run as heartbeat sensor
 -v	verbose mode
 -d	destination ip adress (default = 127.0.0.1)
 -P	destination port number (default = 6220)
 -i	interval in milliseconds (default = 1000)
 -g	server group (default = misc)
 -t	tolerance level (default = 4)

Example
-------
Sensor (10 seconds tolerance level):
 hbeatd -s -t 10

Nodes (800 milliseconds pulse):
 hbeatd -i 800 -d 192.168.1.50

How it works
============
The pulse program on the nodes sends udp packages to chosen sensor. The sensor
collects the ip's along with the server group and builds a list. Everytime a new
heartbeat is received it will update the timestamp for the node and check the
list for dead nodes (nodes with a timestamp older than the tolerance level). If 
a node is dead, a script located at /etc/hbeatd/rc.d will run.
 
Script
======
The script has two arguments, command and node ip. The command argument can be 
new, dead and up.

Example rc.d
-------------
#!/bin/sh

if [ "$1" = "dead" ]; then
        echo "dead: $2($3)" >> /tmp/hbeatd.log
elif [ "$1" = "up" ]; then
        echo "up: $2($3)" >> /tmp/hbeatd.log
elif [ "$1" = "new" ]; then
        echo "new: $2($3)" >> /tmp/hbeatd.log
fi

exit
-------------

Installation
============
make
su
make install


